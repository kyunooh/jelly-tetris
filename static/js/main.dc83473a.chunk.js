(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,t,r){e.exports=r(49)},38:function(e,t,r){},39:function(e,t,r){},45:function(e,t,r){},46:function(e,t,r){},47:function(e,t,r){},48:function(e,t,r){},49:function(e,t,r){"use strict";r.r(t);var n=r(1),o=r.n(n),c=r(17),a=r.n(c),l=(r(38),r(39),r(9)),i=r(4),u=r(8),s=r(50),f="jelly-tetris/tick",m="jelly-tetris/rotate",d="jelly-tetris/drop",v="jelly-tetris/hold",g="jelly-tetris/tickTimer",h=r(6),p=new Audio("http://jellyms.kr/jelly-tetris/kick.wav"),b=3,k={0:[[11,11,11,11]],1:[[12,12,12],[0,0,12]],2:[[13,13,13],[13,0,0]],3:[[14,14],[14,14]],4:[[15,15,15],[0,15,0]],5:[[16,16,0],[0,16,16]],6:[[0,17,17],[17,17,0]]},j=function(e){for(var t=Object(i.a)({},e),r=!1,n=0;n<t.grid.length;n++){for(var o=0;o<t.grid[n].length;o++)if(t.grid[n][o]>10){t.currentBlockLocation=[n,o],r=!0;break}if(r)break}return t},B=function(e){return e.map(function(e){return e.slice()})};function O(e,t,r,n){return e===t.grid.length-1||r[e+1][n]<10&&r[e+1][n]>0}var y=function e(t){var r=Object(i.a)({},t);localStorage.setItem(A,JSON.stringify(r));var n=B(r.grid);if(r.newBlock)return(r=function(e,t){var r=Object(i.a)({},t);if(0===r.currentBlock.length)r.currentBlockNumber=Math.floor(7*Math.random()),r.currentBlock=Object(h.a)(k[r.currentBlockNumber]),r.nextBlockNumber=Math.floor(7*Math.random()),r.nextBlock=Object(h.a)(k[r.nextBlockNumber]);else if(r.hold&&r.holdBlock.length>0)r.temporaryHoldBlockNumber=r.currentBlockNumber,r.currentBlock=Object(h.a)(r.holdBlock);else if(r.hold){r.temporaryHoldBlockNumber=r.currentBlockNumber,r.currentBlock=Object(h.a)(r.nextBlock),r.currentBlockNumber=r.nextBlockNumber,r.nextBlockNumber=Math.floor(7*Math.random());var n=k[r.nextBlockNumber];r.nextBlock=Object(h.a)(n)}else{r.currentBlock=Object(h.a)(r.nextBlock),r.currentBlockNumber=r.nextBlockNumber,r.nextBlockNumber=Math.floor(7*Math.random());var o=k[r.nextBlockNumber];r.nextBlock=Object(h.a)(o)}for(var c=0;c<r.currentBlock.length;c++)for(var a=0;a<r.currentBlock[c].length;a++)e[c][a+b]>0&&e[c][a+b]<10&&(r.gameOver=!0),e[c][a+b]=r.currentBlock[c][a];return r}(n,r)).newBlock=!1,r.dropping=!1,r.hold||(r.canHold=!0),r.hold=!1,r.grid=n,r=j(r);for(var o=n.length-1;o>=0;o--)for(var c=0;c<n[o].length;c++)if(n[o][c]>10){if(O(o,r,n,c)){r.gameOver||p.play(),n=B(r.grid),r.newBlock=!0;for(var a=0;a<n.length;a++)for(var l=n[a],u=!0,s=0;s<l.length;s++)l[s]&&l[s]>10&&(l[s]-=10),l[s]||(u=!1),u&&s===l.length-1&&f(n,a,r);return r.grid=n,e(r)}n[o+1][c]=n[o][c],n[o][c]=0}return r.grid=n,j(r);function f(e,t,r){e.splice(t,1),e.unshift(Array(10).fill(0)),r.removedLines+=1,r.removedLines%8===0&&(r.levels+=1)}},w="jelly-tetris/reset",N=new Audio("http://jellyms.kr/jelly-tetris/whoosh.wav"),x=function(e){return e>10};function E(e,t,r,n,o){return t+r>=e.length||n+o>=e[0].length||e[t+r][n+o]}var L,R=function(e){var t=Object(i.a)({},e);N.play();for(var r=[],n=t.currentBlock.length,o=t.currentBlock[0].length,c=t.currentBlock,a=0;a<o;a++){for(var l=[],u=0;u<n;u++)l.push(c[n-(n-u-1)-1][o-a-1]);r.push(l)}return function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=Object(i.a)({},t);if(n<-4){if(o>2)return;return e(c,r,-1,o+1),c}if(o>2)return n>0&&e(c,r,-1),c;if(n>3)return e(c,r,0,o+1),c;for(var a=B(c.grid),l=0;l<a.length;l++)for(var u=0;u<a[l].length;u++)a[l][u]>10&&(a[l][u]=0);for(var s=c.currentBlockLocation[0]+o,f=c.currentBlockLocation[1]+n,m=0;m<r.length;m++)for(var d=0;d<r[m].length;d++){if(E(a,m,s,d,f))return e(c,r,n>=0?n+1:n-1,o),c;a[m+s][d+f]=r[m][d]}return c.currentBlock=r,c.grid=Object(h.a)(a),c}(t,r)},A="jelly-tetris",H=function(e){var t=localStorage.getItem(A);return t?JSON.parse(t):{newBlock:!0,gameOver:!1,dropping:!1,hold:!1,canHold:!0,removedLines:0,levels:1,currentBlock:[],currentBlockNumber:-1,nextBlock:[],nextBlockNumber:-1,holdBlock:[],playBgm:!e||e.playBgm,temporaryHoldBlockNumber:0,currentBlockLocation:[0,0],grid:Array(16).fill(Array(10).fill(0))}},M=Object(s.a)((L={},Object(u.a)(L,f,function(e){return y(e)}),Object(u.a)(L,"jelly-tetris/moveLeft",function(e){return function(e){for(var t=Object(i.a)({},e),r=B(t.grid),n=!0,o=r.length-1;o>=0;o--)for(var c=r[o],a=0;a<c.length;a++)x(c[a])&&(0===c[a-1]?(r[o][a-1]=r[o][a],r[o][a]=0):n=!1);return n&&(t.grid=r),j(t)}(e)}),Object(u.a)(L,"jelly-tetris/moveRight",function(e){return function(e){for(var t=Object(i.a)({},e),r=B(t.grid),n=!0,o=r.length-1;o>=0;o--)for(var c=r[o],a=c.length-1;a>=0;a--)if(x(c[a]))if(0===c[a+1]){var l=r[o][a];r[o][a]=0,r[o][a+1]=l}else n=!1;return n&&(t.grid=r),t=j(t),Object(i.a)({},t)}(e)}),Object(u.a)(L,m,function(e){return R(e)}),Object(u.a)(L,d,function(e){return function(e){var t=Object(i.a)({},e);for(t.dropping=!0;t.dropping;)t=y(t);return t}(e)}),Object(u.a)(L,w,function(e){return function(e){return localStorage.setItem(A,""),H(e)}(e)}),Object(u.a)(L,v,function(e){return function(e){var t=Object(i.a)({},e);if(!t.canHold)return Object(i.a)({},t);t.canHold=!1,t.hold=!0;for(var r=0;r<t.grid.length;r++)for(var n=0;n<t.grid[r].length;n++)t.grid[r][n]>10&&(t.grid[r][n]=0);return t.newBlock=!0,(t=y(t)).holdBlock=k[t.temporaryHoldBlockNumber],t}(e)}),Object(u.a)(L,"jelly-tetris/playBgm",function(e){return function(e){var t=Object(i.a)({},e);return t.playBgm=!0,t}(e)}),Object(u.a)(L,"jelly-tetris/pauseBgm",function(e){return function(e){var t=Object(i.a)({},e);return t.playBgm=!1,t}(e)}),L),H()),S=function(e){return Object(l.c)(Object(i.a)({tetrisReducer:M},e))},T=r(30),D=r(12),I=r.n(D),J=r(16),F=r(51),P=Object(F.a)(f),C=Object(F.a)("jelly-tetris/moveLeft"),G=Object(F.a)("jelly-tetris/moveRight"),U=Object(F.a)(m),W=Object(F.a)(d),z=Object(F.a)(w),X=Object(F.a)(v),$=Object(F.a)(g),q=I.a.mark(Y),K=I.a.mark(Z),Q=I.a.mark(_),V=function(e){return new Promise(function(t){return setTimeout(t,e)})};function Y(){var e;return I.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(J.c)(function(e){return e.tetrisReducer.levels});case 2:return e=t.sent,t.next=5,V(1e3*Math.pow(.85,e));case 5:return t.next=7,Object(J.b)(P());case 7:case"end":return t.stop()}},q)}function Z(){return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(J.d)(g,function(){return Y()});case 2:case"end":return e.stop()}},K)}function _(){return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(J.a)([Z()]);case 2:case"end":return e.stop()}},Q)}var ee=function(){var e=Object(T.a)(),t=Object(l.e)(S(),Object(l.a)(e));return t.asyncReducers={},t.injectReducer=function(e,r){t.asyncReducers[e]=r,t.replaceReducer(S(t.asyncReducers))},e.run(_),t},te=r(14);r(45),r(46);var re=function(e){return e.blockNumber?o.a.createElement("span",{className:"cell fill-".concat(e.blockNumber)},"\xa0"):o.a.createElement("span",{className:"cell empty"},"\xa0")};var ne=function(e){var t=e.grid,r=[];function n(e){for(var r=[],n=0;n<t[e].length;n++)r.push(o.a.createElement(re,{key:"".concat(e,"-").concat(n),blockNumber:t[e][n]}));return r}for(var c=0;c<t.length;c++)r.push(o.a.createElement("div",{className:"row",key:c},n(c)));return r},oe=(r(47),function(){return o.a.createElement("div",{id:"game-over"},"Game Over")});var ce=function(e){var t=e.grid;return e.tickTimer(),document.onkeydown=function(t){"ArrowLeft"===t.key&&e.moveLeft(),"ArrowRight"===t.key&&e.moveRight(),"ArrowDown"===t.key&&e.tick(),"ArrowUp"===t.key&&e.rotate()," "===t.key&&e.drop(),"Shift"===t.key&&e.hold()},o.a.createElement("div",{className:"play-view"},e.gameOver?o.a.createElement(oe,null):o.a.createElement(ne,{grid:t}))},ae=Object(te.b)(function(e){return Object(i.a)({},e.tetrisReducer)},function(e){return{tick:function(){return e(P())},moveLeft:function(){return e(C())},moveRight:function(){return e(G())},rotate:function(){return e(U())},drop:function(){return e(W())},tickTimer:function(){return e($())},hold:function(){return e(X())}}})(function(e){return o.a.createElement(ce,{tick:function(){e.tick()},moveLeft:function(){e.moveLeft()},moveRight:function(){e.moveRight()},rotate:function(){e.rotate()},drop:function(){e.drop()},tickTimer:function(){e.tickTimer()},hold:function(){e.hold()},grid:e.grid,levels:e.levels,gameOver:e.gameOver})}),le=r(27),ie=r(28),ue=r(31),se=r(29),fe=r(32),me=(r(48),function(e){function t(){return Object(le.a)(this,t),Object(ue.a)(this,Object(se.a)(t).apply(this,arguments))}return Object(fe.a)(t,e),Object(ie.a)(t,[{key:"componentDidUpdate",value:function(){this.setBgm()}},{key:"setBgm",value:function(){var e=this.props.bgmAudio.current;e&&(e.playbackRate=.96+.04*this.props.levels,this.props.playBgm?e.play():e.pause())}},{key:"render",value:function(){return o.a.createElement("div",{id:"information-window"},o.a.createElement(ne,{grid:de(this.props.nextBlock)}),o.a.createElement("div",null,"NEXT"),o.a.createElement(ne,{grid:de(this.props.holdBlock)}),o.a.createElement("div",null,"HOLD (shift)"),o.a.createElement("div",{id:"removed-lines"},"Lines: ",this.props.removedLines),o.a.createElement("div",{id:"levels"},"Level: ",this.props.levels),o.a.createElement("button",{id:"prevent-reset",ref:this.props.preventFocus,style:{width:"0px",height:"0px"}}),o.a.createElement("button",{className:"reset-button",onClick:this.props.reset},"Reset"),o.a.createElement("div",{id:"audio-panel"},o.a.createElement("audio",{id:"bgm-audio",ref:this.props.bgmAudio,controls:!0,onPause:this.props.pauseBgm,onPlay:this.props.playBgm,loop:!0},o.a.createElement("source",{src:"http://jellyms.kr/jelly-tetris/tetris.ogg",type:"audio/ogg; codecs=vorbis"}))),o.a.createElement("div",null,o.a.createElement("a",{href:"https://github.com/kyunooh/jelly-tetris",style:{textDecoration:"none",color:"#AAF",fontSize:"20px"}},"Github")))}}]),t}(o.a.Component)),de=function(e){for(var t=Array(5).fill(0),r=[Object(h.a)(t),Object(h.a)(t),Object(h.a)(t),Object(h.a)(t)],n=0;n<e.length;n++)for(var o=0;o<e[n].length;o++)r[n+1][o+1]=e[n][o];return r},ve=me,ge=Object(F.a)("jelly-tetris/playBgm"),he=Object(F.a)("jelly-tetris/pauseBgm"),pe=Object(te.b)(function(e){return Object(i.a)({},e.tetrisReducer)},function(e){return{reset:function(){return e(z())},pauseBgm:function(){return e(he())},playBgm:function(){return e(ge())}}})(function(e){var t=o.a.createRef(),r=o.a.createRef();return o.a.createElement(ve,{nextBlock:e.nextBlock,holdBlock:e.holdBlock,removedLines:e.removedLines,levels:e.levels,preventFocus:t,bgmAudio:r,playBgm:function(){e.playBgm(),t.current.focus()},pauseBgm:function(){e.pauseBgm(),t.current.focus()},reset:function(){e.reset(),t.current.focus()}})}),be=ee();var ke=function(){return o.a.createElement(te.a,{store:be},o.a.createElement("div",{className:"App"},o.a.createElement(ae,null),o.a.createElement(pe,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(ke,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,1,2]]]);
//# sourceMappingURL=main.dc83473a.chunk.js.map